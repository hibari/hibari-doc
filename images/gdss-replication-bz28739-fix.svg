<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="600pt" height="1216pt" version="1.1" viewBox="0 0 600 1216"
 width="600px" height="1216px"
 viewBox="0 0 600 1216"
 xmlns="http://www.w3.org/2000/svg" shape-rendering="crispEdges"
 stroke-width="1" text-rendering="geometricPrecision">
<polygon fill="white" points="37,7 81,7 81,16 37,16"/>
<text x="60" y="16" textLength="43" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

CLIENT
</text>
<polygon fill="white" points="162,7 196,7 196,16 162,16"/>
<text x="180" y="16" textLength="33" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

HEAD
</text>
<polygon fill="white" points="276,7 322,7 322,16 276,16"/>
<text x="300" y="16" textLength="45" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

MIDDLE
</text>
<polygon fill="white" points="406,7 432,7 432,16 406,16"/>
<text x="420" y="16" textLength="25" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

TAIL
</text>
<polygon fill="white" points="519,7 559,7 559,16 519,16"/>
<text x="540" y="16" textLength="39" font-family="Helvetica" font-size="12" fill="black" text-anchor="middle">

ADMIN
</text>
<line x1="60" y1="22" x2="60" y2="39" stroke="black"/>
<line x1="180" y1="22" x2="180" y2="39" stroke="black"/>
<line x1="300" y1="22" x2="300" y2="39" stroke="black"/>
<line x1="420" y1="22" x2="420" y2="39" stroke="black"/>
<line x1="540" y1="22" x2="540" y2="39" stroke="black"/>
<line x1="30" y1="27" x2="570" y2="27" stroke="black" stroke-dasharray="2,2"/>
<polygon fill="white" points="267,23 331,23 331,32 267,32"/>
<text x="268" y="32" textLength="62" font-family="Helvetica" font-size="12" fill="black">
D1 = K1,V1
</text>
<line x1="60" y1="39" x2="60" y2="67" stroke="black"/>
<line x1="180" y1="39" x2="180" y2="67" stroke="black"/>
<line x1="300" y1="39" x2="300" y2="67" stroke="black"/>
<line x1="420" y1="39" x2="420" y2="67" stroke="black"/>
<line x1="540" y1="39" x2="540" y2="67" stroke="black"/>
<line x1="60" y1="50" x2="180" y2="50" stroke="black"/>
<line x1="180" y1="50" x2="170" y2="56" stroke="black"/>
<polygon fill="white" points="88,40 151,40 151,49 88,49"/>
<text x="89" y="49" textLength="61" font-family="Helvetica" font-size="12" fill="black">
add(K1,V1)
</text>
<line x1="60" y1="67" x2="60" y2="95" stroke="black"/>
<line x1="180" y1="67" x2="180" y2="95" stroke="black"/>
<line x1="300" y1="67" x2="300" y2="95" stroke="black"/>
<line x1="420" y1="67" x2="420" y2="95" stroke="black"/>
<line x1="540" y1="67" x2="540" y2="95" stroke="black"/>
<polygon fill="white" points="128,67 232,67 232,89 128,89"/>
<line x1="128" y1="67" x2="232" y2="67" stroke="black"/>
<line x1="128" y1="89" x2="232" y2="89" stroke="black"/>
<line x1="128" y1="67" x2="128" y2="89" stroke="black"/>
<line x1="232" y1="67" x2="232" y2="89" stroke="black"/>
<polygon fill="white" points="149,68 209,68 209,77 149,77"/>
<text x="150" y="77" textLength="58" font-family="Helvetica" font-size="12" fill="black">
replay=D1;
</text>
<polygon fill="white" points="153,79 205,79 205,88 153,88"/>
<text x="154" y="88" textLength="50" font-family="Helvetica" font-size="12" fill="black">
down=S1
</text>
<line x1="60" y1="95" x2="60" y2="123" stroke="black"/>
<line x1="180" y1="95" x2="180" y2="123" stroke="black"/>
<line x1="300" y1="95" x2="300" y2="123" stroke="black"/>
<line x1="420" y1="95" x2="420" y2="123" stroke="black"/>
<line x1="540" y1="95" x2="540" y2="123" stroke="black"/>
<line x1="180" y1="106" x2="300" y2="106" stroke="black"/>
<line x1="300" y1="106" x2="290" y2="112" stroke="black"/>
<polygon fill="white" points="164,96 314,96 314,105 164,105"/>
<text x="165" y="105" textLength="148" font-family="Helvetica" font-size="12" fill="black">
ch_replay_v2(K1,V1,S1,S0)
</text>
<line x1="60" y1="123" x2="60" y2="151" stroke="black"/>
<line x1="180" y1="123" x2="180" y2="151" stroke="black"/>
<line x1="300" y1="123" x2="300" y2="151" stroke="black"/>
<line x1="420" y1="123" x2="420" y2="151" stroke="black"/>
<line x1="540" y1="123" x2="540" y2="151" stroke="black"/>
<polygon fill="white" points="248,123 352,123 352,145 248,145"/>
<line x1="248" y1="123" x2="352" y2="123" stroke="black"/>
<line x1="248" y1="145" x2="352" y2="145" stroke="black"/>
<line x1="248" y1="123" x2="248" y2="145" stroke="black"/>
<line x1="352" y1="123" x2="352" y2="145" stroke="black"/>
<polygon fill="white" points="269,124 329,124 329,133 269,133"/>
<text x="270" y="133" textLength="58" font-family="Helvetica" font-size="12" fill="black">
replay=D1;
</text>
<polygon fill="white" points="281,135 318,135 318,144 281,144"/>
<text x="282" y="144" textLength="35" font-family="Helvetica" font-size="12" fill="black">
up=S1
</text>
<line x1="60" y1="151" x2="60" y2="179" stroke="black"/>
<line x1="180" y1="151" x2="180" y2="179" stroke="black"/>
<line x1="300" y1="151" x2="300" y2="179" stroke="black"/>
<line x1="420" y1="151" x2="420" y2="179" stroke="black"/>
<line x1="540" y1="151" x2="540" y2="179" stroke="black"/>
<line x1="300" y1="162" x2="420" y2="162" stroke="black"/>
<line x1="420" y1="162" x2="410" y2="168" stroke="black"/>
<polygon fill="white" points="284,152 434,152 434,161 284,161"/>
<text x="285" y="161" textLength="148" font-family="Helvetica" font-size="12" fill="black">
ch_replay_v2(K1,V1,S1,S0)
</text>
<line x1="60" y1="179" x2="60" y2="207" stroke="black"/>
<line x1="180" y1="179" x2="180" y2="207" stroke="black"/>
<line x1="300" y1="179" x2="300" y2="207" stroke="black"/>
<line x1="420" y1="179" x2="420" y2="207" stroke="black"/>
<line x1="540" y1="179" x2="540" y2="207" stroke="black"/>
<polygon fill="white" points="368,179 472,179 472,201 368,201"/>
<line x1="368" y1="179" x2="472" y2="179" stroke="black"/>
<line x1="368" y1="201" x2="472" y2="201" stroke="black"/>
<line x1="368" y1="179" x2="368" y2="201" stroke="black"/>
<line x1="472" y1="179" x2="472" y2="201" stroke="black"/>
<polygon fill="white" points="389,180 449,180 449,189 389,189"/>
<text x="390" y="189" textLength="58" font-family="Helvetica" font-size="12" fill="black">
replay=D1;
</text>
<polygon fill="white" points="401,191 438,191 438,200 401,200"/>
<text x="402" y="200" textLength="35" font-family="Helvetica" font-size="12" fill="black">
up=S1
</text>
<line x1="60" y1="207" x2="60" y2="235" stroke="black"/>
<line x1="180" y1="207" x2="180" y2="235" stroke="black"/>
<line x1="300" y1="207" x2="300" y2="235" stroke="black"/>
<line x1="420" y1="207" x2="420" y2="235" stroke="black"/>
<line x1="540" y1="207" x2="540" y2="235" stroke="black"/>
<line x1="420" y1="218" x2="60" y2="218" stroke="black"/>
<line x1="60" y1="218" x2="70" y2="224" stroke="black"/>
<polygon fill="white" points="232,208 247,208 247,217 232,217"/>
<text x="233" y="217" textLength="13" font-family="Helvetica" font-size="12" fill="black">
ok
</text>
<line x1="60" y1="235" x2="60" y2="252" stroke="black"/>
<line x1="180" y1="235" x2="180" y2="252" stroke="black"/>
<line x1="300" y1="235" x2="300" y2="252" stroke="black"/>
<line x1="420" y1="235" x2="420" y2="252" stroke="black"/>
<line x1="540" y1="235" x2="540" y2="252" stroke="black"/>
<line x1="30" y1="240" x2="570" y2="240" stroke="black" stroke-dasharray="2,2"/>
<polygon fill="white" points="202,236 396,236 396,245 202,245"/>
<text x="203" y="245" textLength="192" font-family="Helvetica" font-size="12" fill="black">
D2 is lost between Head and Middle
</text>
<line x1="60" y1="252" x2="60" y2="280" stroke="black"/>
<line x1="180" y1="252" x2="180" y2="280" stroke="black"/>
<line x1="300" y1="252" x2="300" y2="280" stroke="black"/>
<line x1="420" y1="252" x2="420" y2="280" stroke="black"/>
<line x1="540" y1="252" x2="540" y2="280" stroke="black"/>
<line x1="60" y1="263" x2="180" y2="263" stroke="black"/>
<line x1="180" y1="263" x2="170" y2="269" stroke="black"/>
<polygon fill="white" points="88,253 151,253 151,262 88,262"/>
<text x="89" y="262" textLength="61" font-family="Helvetica" font-size="12" fill="black">
add(K2,V2)
</text>
<line x1="60" y1="280" x2="60" y2="308" stroke="black"/>
<line x1="180" y1="280" x2="180" y2="308" stroke="black"/>
<line x1="300" y1="280" x2="300" y2="308" stroke="black"/>
<line x1="420" y1="280" x2="420" y2="308" stroke="black"/>
<line x1="540" y1="280" x2="540" y2="308" stroke="black"/>
<polygon fill="white" points="128,280 232,280 232,302 128,302"/>
<line x1="128" y1="280" x2="232" y2="280" stroke="black"/>
<line x1="128" y1="302" x2="232" y2="302" stroke="black"/>
<line x1="128" y1="280" x2="128" y2="302" stroke="black"/>
<line x1="232" y1="280" x2="232" y2="302" stroke="black"/>
<polygon fill="white" points="140,281 219,281 219,290 140,290"/>
<text x="141" y="290" textLength="77" font-family="Helvetica" font-size="12" fill="black">
replay=D1,D2;
</text>
<polygon fill="white" points="153,292 205,292 205,301 153,301"/>
<text x="154" y="301" textLength="50" font-family="Helvetica" font-size="12" fill="black">
down=S2
</text>
<line x1="60" y1="308" x2="60" y2="336" stroke="black"/>
<line x1="180" y1="308" x2="180" y2="336" stroke="black"/>
<line x1="300" y1="308" x2="300" y2="336" stroke="black"/>
<line x1="420" y1="308" x2="420" y2="336" stroke="black"/>
<line x1="540" y1="308" x2="540" y2="336" stroke="black"/>
<line x1="180" y1="318" x2="300" y2="318" stroke="black"/>
<line x1="180" y1="320" x2="300" y2="320" stroke="black"/>
<polygon fill="black" points="300,319 290,325 290,313"/>
<polygon fill="white" points="114,309 365,309 365,318 114,318"/>
<text x="115" y="318" textLength="249" font-family="Helvetica" font-size="12" fill="black">
MESSAGE LOST: ch_replay_v2(K2,V2,S2,S1)
</text>
<line x1="60" y1="336" x2="60" y2="353" stroke="black" stroke-dasharray="2,2"/>
<line x1="180" y1="336" x2="180" y2="353" stroke="black" stroke-dasharray="2,2"/>
<line x1="300" y1="336" x2="300" y2="353" stroke="black" stroke-dasharray="2,2"/>
<line x1="420" y1="336" x2="420" y2="353" stroke="black" stroke-dasharray="2,2"/>
<line x1="540" y1="336" x2="540" y2="353" stroke="black" stroke-dasharray="2,2"/>
<line x1="60" y1="353" x2="60" y2="381" stroke="black"/>
<line x1="180" y1="353" x2="180" y2="381" stroke="black"/>
<line x1="300" y1="353" x2="300" y2="381" stroke="black"/>
<line x1="420" y1="353" x2="420" y2="381" stroke="black"/>
<line x1="540" y1="353" x2="540" y2="381" stroke="black"/>
<path d="M 60 370 A58,6 0 0,1 60,358" stroke="black" fill="none"/><line x1="60" y1="370" x2="50" y2="376" stroke="black"/>
<polygon fill="white" points="60,354 101,354 101,363 60,363"/>
<text x="61" y="363" textLength="39" font-family="Helvetica" font-size="12" fill="black">
timeout
</text>
<line x1="60" y1="381" x2="60" y2="398" stroke="black" stroke-dasharray="2,2"/>
<line x1="180" y1="381" x2="180" y2="398" stroke="black" stroke-dasharray="2,2"/>
<line x1="300" y1="381" x2="300" y2="398" stroke="black" stroke-dasharray="2,2"/>
<line x1="420" y1="381" x2="420" y2="398" stroke="black" stroke-dasharray="2,2"/>
<line x1="540" y1="381" x2="540" y2="398" stroke="black" stroke-dasharray="2,2"/>
<line x1="60" y1="398" x2="60" y2="415" stroke="black"/>
<line x1="180" y1="398" x2="180" y2="415" stroke="black"/>
<line x1="300" y1="398" x2="300" y2="415" stroke="black"/>
<line x1="420" y1="398" x2="420" y2="415" stroke="black"/>
<line x1="540" y1="398" x2="540" y2="415" stroke="black"/>
<line x1="30" y1="403" x2="570" y2="403" stroke="black" stroke-dasharray="2,2"/>
<polygon fill="white" points="196,399 403,399 403,408 196,408"/>
<text x="197" y="408" textLength="205" font-family="Helvetica" font-size="12" fill="black">
Behaviour has changed from this point
</text>
<line x1="60" y1="415" x2="60" y2="432" stroke="black" stroke-dasharray="2,2"/>
<line x1="180" y1="415" x2="180" y2="432" stroke="black" stroke-dasharray="2,2"/>
<line x1="300" y1="415" x2="300" y2="432" stroke="black" stroke-dasharray="2,2"/>
<line x1="420" y1="415" x2="420" y2="432" stroke="black" stroke-dasharray="2,2"/>
<line x1="540" y1="415" x2="540" y2="432" stroke="black" stroke-dasharray="2,2"/>
<line x1="60" y1="432" x2="60" y2="449" stroke="black"/>
<line x1="180" y1="432" x2="180" y2="449" stroke="black"/>
<line x1="300" y1="432" x2="300" y2="449" stroke="black"/>
<line x1="420" y1="432" x2="420" y2="449" stroke="black"/>
<line x1="540" y1="432" x2="540" y2="449" stroke="black"/>
<line x1="30" y1="437" x2="570" y2="437" stroke="black" stroke-dasharray="2,2"/>
<polygon fill="white" points="267,433 331,433 331,442 267,442"/>
<text x="268" y="442" textLength="62" font-family="Helvetica" font-size="12" fill="black">
D3 = K3,V3
</text>
<line x1="60" y1="449" x2="60" y2="477" stroke="black"/>
<line x1="180" y1="449" x2="180" y2="477" stroke="black"/>
<line x1="300" y1="449" x2="300" y2="477" stroke="black"/>
<line x1="420" y1="449" x2="420" y2="477" stroke="black"/>
<line x1="540" y1="449" x2="540" y2="477" stroke="black"/>
<line x1="60" y1="460" x2="180" y2="460" stroke="black"/>
<line x1="180" y1="460" x2="170" y2="466" stroke="black"/>
<polygon fill="white" points="88,450 151,450 151,459 88,459"/>
<text x="89" y="459" textLength="61" font-family="Helvetica" font-size="12" fill="black">
add(K3,V3)
</text>
<line x1="60" y1="477" x2="60" y2="505" stroke="black"/>
<line x1="180" y1="477" x2="180" y2="505" stroke="black"/>
<line x1="300" y1="477" x2="300" y2="505" stroke="black"/>
<line x1="420" y1="477" x2="420" y2="505" stroke="black"/>
<line x1="540" y1="477" x2="540" y2="505" stroke="black"/>
<polygon fill="white" points="128,477 232,477 232,499 128,499"/>
<line x1="128" y1="477" x2="232" y2="477" stroke="black"/>
<line x1="128" y1="499" x2="232" y2="499" stroke="black"/>
<line x1="128" y1="477" x2="128" y2="499" stroke="black"/>
<line x1="232" y1="477" x2="232" y2="499" stroke="black"/>
<polygon fill="white" points="130,478 228,478 228,487 130,487"/>
<text x="131" y="487" textLength="96" font-family="Helvetica" font-size="12" fill="black">
replay=D1,D2,D3;
</text>
<polygon fill="white" points="153,489 205,489 205,498 153,498"/>
<text x="154" y="498" textLength="50" font-family="Helvetica" font-size="12" fill="black">
down=S3
</text>
<line x1="60" y1="505" x2="60" y2="533" stroke="black"/>
<line x1="180" y1="505" x2="180" y2="533" stroke="black"/>
<line x1="300" y1="505" x2="300" y2="533" stroke="black"/>
<line x1="420" y1="505" x2="420" y2="533" stroke="black"/>
<line x1="540" y1="505" x2="540" y2="533" stroke="black"/>
<path d="M 300 509 A60,6 0 0,1 300,521" stroke="black" fill="none"/><path d="M 300 511 A60,6 0 0,1 300,523" stroke="black" fill="none"/><polygon fill="black" points="300,522 310,528 310,516"/>
<polygon fill="white" points="258,506 298,506 298,515 258,515"/>
<text x="259" y="515" textLength="38" font-family="Helvetica" font-size="12" fill="black">
DOWN
</text>
<line x1="60" y1="533" x2="60" y2="572" stroke="black"/>
<line x1="180" y1="533" x2="180" y2="572" stroke="black"/>
<line x1="300" y1="533" x2="300" y2="572" stroke="black"/>
<line x1="420" y1="533" x2="420" y2="572" stroke="black"/>
<line x1="540" y1="533" x2="540" y2="572" stroke="black"/>
<polygon fill="white" points="248,533 352,533 352,566 248,566"/>
<line x1="248" y1="533" x2="352" y2="533" stroke="black"/>
<line x1="248" y1="566" x2="352" y2="566" stroke="black"/>
<line x1="248" y1="533" x2="248" y2="566" stroke="black"/>
<line x1="352" y1="533" x2="352" y2="566" stroke="black"/>
<polygon fill="white" points="269,534 329,534 329,543 269,543"/>
<text x="270" y="543" textLength="58" font-family="Helvetica" font-size="12" fill="black">
replay=D1;
</text>
<polygon fill="white" points="279,545 319,545 319,554 279,554"/>
<text x="280" y="554" textLength="38" font-family="Helvetica" font-size="12" fill="black">
up=S1;
</text>
<polygon fill="white" points="252,556 346,556 346,565 252,565"/>
<text x="253" y="565" textLength="92" font-family="Helvetica" font-size="12" fill="black">
got_down=TRUE
</text>
<line x1="60" y1="572" x2="60" y2="600" stroke="black"/>
<line x1="180" y1="572" x2="180" y2="600" stroke="black"/>
<line x1="300" y1="572" x2="300" y2="600" stroke="black"/>
<line x1="420" y1="572" x2="420" y2="600" stroke="black"/>
<line x1="540" y1="572" x2="540" y2="600" stroke="black"/>
<line x1="180" y1="583" x2="300" y2="583" stroke="black"/>
<line x1="300" y1="583" x2="290" y2="589" stroke="black"/>
<polygon fill="white" points="164,573 314,573 314,582 164,582"/>
<text x="165" y="582" textLength="148" font-family="Helvetica" font-size="12" fill="black">
ch_replay_v2(K3,V3,S3,S2)
</text>
<line x1="60" y1="600" x2="60" y2="650" stroke="black"/>
<line x1="180" y1="600" x2="180" y2="650" stroke="black"/>
<line x1="300" y1="600" x2="300" y2="650" stroke="black"/>
<line x1="420" y1="600" x2="420" y2="650" stroke="black"/>
<line x1="540" y1="600" x2="540" y2="650" stroke="black"/>
<polygon fill="white" points="254,600 346,600 346,644 254,644"/>
<polygon fill="white" points="254,600 254,644 248,622"/>
<polygon fill="white" points="346,600 346,644 352,622"/>
<line x1="254" y1="600" x2="346" y2="600" stroke="black"/>
<line x1="254" y1="644" x2="346" y2="644" stroke="black"/>
<line x1="254" y1="600" x2="248" y2="622" stroke="black"/>
<line x1="248" y1="622" x2="254" y2="644" stroke="black"/>
<line x1="346" y1="600" x2="352" y2="622" stroke="black"/>
<line x1="352" y1="622" x2="346" y2="644" stroke="black"/>
<polygon fill="white" points="268,601 331,601 331,610 268,610"/>
<text x="269" y="610" textLength="61" font-family="Helvetica" font-size="12" fill="black">
last&lt;S2&gt; !=
</text>
<polygon fill="white" points="268,612 331,612 331,621 268,621"/>
<text x="269" y="621" textLength="61" font-family="Helvetica" font-size="12" fill="black">
up&lt;S1&gt; &amp;&amp;
</text>
<polygon fill="white" points="255,623 343,623 343,632 255,632"/>
<text x="256" y="632" textLength="86" font-family="Helvetica" font-size="12" fill="black">
got_down==TR-
</text>
<polygon fill="white" points="290,634 309,634 309,643 290,643"/>
<text x="291" y="643" textLength="17" font-family="Helvetica" font-size="12" fill="black">
UE
</text>
<line x1="60" y1="650" x2="60" y2="678" stroke="black"/>
<line x1="180" y1="650" x2="180" y2="678" stroke="black"/>
<line x1="300" y1="650" x2="300" y2="678" stroke="black"/>
<line x1="420" y1="650" x2="420" y2="678" stroke="black"/>
<line x1="540" y1="650" x2="540" y2="678" stroke="black"/>
<path d="M 300 654 A60,6 0 0,1 300,666" stroke="black" fill="none"/><path d="M 300 656 A60,6 0 0,1 300,668" stroke="black" fill="none"/><polygon fill="black" points="300,667 310,673 310,661"/>
<polygon fill="white" points="181,651 298,651 298,660 181,660"/>
<text x="182" y="660" textLength="115" font-family="Helvetica" font-size="12" fill="black">
MIDDLE BRICK EXIT
</text>
<line x1="60" y1="678" x2="60" y2="695" stroke="black"/>
<line x1="180" y1="678" x2="180" y2="695" stroke="black"/>
<line x1="300" y1="678" x2="300" y2="695" stroke="black"/>
<line x1="420" y1="678" x2="420" y2="695" stroke="black"/>
<line x1="540" y1="678" x2="540" y2="695" stroke="black"/>
<line x1="30" y1="683" x2="570" y2="683" stroke="black" stroke-dasharray="2,2"/>
<polygon fill="white" points="171,679 428,679 428,688 171,688"/>
<text x="172" y="688" textLength="255" font-family="Helvetica" font-size="12" fill="black">
Admin changes connections to remove MIDDLE
</text>
<line x1="60" y1="695" x2="60" y2="723" stroke="black"/>
<line x1="180" y1="695" x2="180" y2="723" stroke="black"/>
<line x1="300" y1="695" x2="300" y2="723" stroke="black"/>
<line x1="420" y1="695" x2="420" y2="723" stroke="black"/>
<line x1="540" y1="695" x2="540" y2="723" stroke="black"/>
<path d="M 420 699 A60,6 0 0,1 420,711" stroke="black" fill="none"/><path d="M 420 701 A60,6 0 0,1 420,713" stroke="black" fill="none"/><polygon fill="black" points="420,712 430,718 430,706"/>
<polygon fill="white" points="378,696 418,696 418,705 378,705"/>
<text x="379" y="705" textLength="38" font-family="Helvetica" font-size="12" fill="black">
DOWN
</text>
<line x1="60" y1="723" x2="60" y2="762" stroke="black"/>
<line x1="180" y1="723" x2="180" y2="762" stroke="black"/>
<line x1="300" y1="723" x2="300" y2="762" stroke="black"/>
<line x1="420" y1="723" x2="420" y2="762" stroke="black"/>
<line x1="540" y1="723" x2="540" y2="762" stroke="black"/>
<polygon fill="white" points="368,723 472,723 472,756 368,756"/>
<line x1="368" y1="723" x2="472" y2="723" stroke="black"/>
<line x1="368" y1="756" x2="472" y2="756" stroke="black"/>
<line x1="368" y1="723" x2="368" y2="756" stroke="black"/>
<line x1="472" y1="723" x2="472" y2="756" stroke="black"/>
<polygon fill="white" points="387,724 451,724 451,733 387,733"/>
<text x="388" y="733" textLength="62" font-family="Helvetica" font-size="12" fill="black">
replay=D1 ;
</text>
<polygon fill="white" points="399,735 439,735 439,744 399,744"/>
<text x="400" y="744" textLength="38" font-family="Helvetica" font-size="12" fill="black">
up=S1;
</text>
<polygon fill="white" points="372,746 466,746 466,755 372,755"/>
<text x="373" y="755" textLength="92" font-family="Helvetica" font-size="12" fill="black">
got_down=TRUE
</text>
<line x1="60" y1="762" x2="60" y2="790" stroke="black"/>
<line x1="180" y1="762" x2="180" y2="790" stroke="black"/>
<line x1="300" y1="762" x2="300" y2="790" stroke="black"/>
<line x1="420" y1="762" x2="420" y2="790" stroke="black"/>
<line x1="540" y1="762" x2="540" y2="790" stroke="black"/>
<line x1="540" y1="773" x2="420" y2="773" stroke="black"/>
<line x1="420" y1="773" x2="430" y2="779" stroke="black"/>
<polygon fill="white" points="370,763 588,763 588,772 370,772"/>
<text x="371" y="772" textLength="216" font-family="Helvetica" font-size="12" fill="black">
role_tail(upstream=HEAD,downstream=)
</text>
<line x1="60" y1="790" x2="60" y2="840" stroke="black"/>
<line x1="180" y1="790" x2="180" y2="840" stroke="black"/>
<line x1="300" y1="790" x2="300" y2="840" stroke="black"/>
<line x1="420" y1="790" x2="420" y2="840" stroke="black"/>
<line x1="540" y1="790" x2="540" y2="840" stroke="black"/>
<polygon fill="white" points="368,790 472,790 472,834 368,834"/>
<line x1="368" y1="790" x2="472" y2="790" stroke="black"/>
<line x1="368" y1="834" x2="472" y2="834" stroke="black"/>
<line x1="368" y1="790" x2="368" y2="834" stroke="black"/>
<line x1="472" y1="790" x2="472" y2="834" stroke="black"/>
<polygon fill="white" points="387,791 451,791 451,800 387,800"/>
<text x="388" y="800" textLength="62" font-family="Helvetica" font-size="12" fill="black">
replay=D1 ;
</text>
<polygon fill="white" points="399,802 439,802 439,811 399,811"/>
<text x="400" y="811" textLength="38" font-family="Helvetica" font-size="12" fill="black">
up=S1;
</text>
<polygon fill="white" points="376,813 463,813 463,822 376,822"/>
<text x="377" y="822" textLength="85" font-family="Helvetica" font-size="12" fill="black">
got_down=FAL-
</text>
<polygon fill="white" points="410,824 428,824 428,833 410,833"/>
<text x="411" y="833" textLength="16" font-family="Helvetica" font-size="12" fill="black">
SE
</text>
<line x1="60" y1="840" x2="60" y2="868" stroke="black"/>
<line x1="180" y1="840" x2="180" y2="868" stroke="black"/>
<line x1="300" y1="840" x2="300" y2="868" stroke="black"/>
<line x1="420" y1="840" x2="420" y2="868" stroke="black"/>
<line x1="540" y1="840" x2="540" y2="868" stroke="black"/>
<line x1="540" y1="851" x2="180" y2="851" stroke="black"/>
<line x1="180" y1="851" x2="190" y2="857" stroke="black"/>
<polygon fill="white" points="249,841 470,841 470,850 249,850"/>
<text x="250" y="850" textLength="219" font-family="Helvetica" font-size="12" fill="black">
role_head(upstream=,downstream=TAIL)
</text>
<line x1="60" y1="868" x2="60" y2="885" stroke="black"/>
<line x1="180" y1="868" x2="180" y2="885" stroke="black"/>
<line x1="300" y1="868" x2="300" y2="885" stroke="black"/>
<line x1="420" y1="868" x2="420" y2="885" stroke="black"/>
<line x1="540" y1="868" x2="540" y2="885" stroke="black"/>
<line x1="30" y1="873" x2="570" y2="873" stroke="black" stroke-dasharray="2,2"/>
<polygon fill="white" points="181,869 417,869 417,878 181,878"/>
<text x="182" y="878" textLength="234" font-family="Helvetica" font-size="12" fill="black">
HEAD replays to new DOWNSTREAM TAIL
</text>
<line x1="60" y1="885" x2="60" y2="913" stroke="black"/>
<line x1="180" y1="885" x2="180" y2="913" stroke="black"/>
<line x1="300" y1="885" x2="300" y2="913" stroke="black"/>
<line x1="420" y1="885" x2="420" y2="913" stroke="black"/>
<line x1="540" y1="885" x2="540" y2="913" stroke="black"/>
<line x1="180" y1="896" x2="420" y2="896" stroke="black"/>
<line x1="420" y1="896" x2="410" y2="902" stroke="black"/>
<polygon fill="white" points="224,886 374,886 374,895 224,895"/>
<text x="225" y="895" textLength="148" font-family="Helvetica" font-size="12" fill="black">
ch_replay_v2(K1,V1,S1,S0)
</text>
<line x1="60" y1="913" x2="60" y2="941" stroke="black"/>
<line x1="180" y1="913" x2="180" y2="941" stroke="black"/>
<line x1="300" y1="913" x2="300" y2="941" stroke="black"/>
<line x1="420" y1="913" x2="420" y2="941" stroke="black"/>
<line x1="540" y1="913" x2="540" y2="941" stroke="black"/>
<polygon fill="white" points="368,913 472,913 472,935 368,935"/>
<line x1="368" y1="913" x2="472" y2="913" stroke="black"/>
<line x1="368" y1="935" x2="472" y2="935" stroke="black"/>
<line x1="368" y1="913" x2="368" y2="935" stroke="black"/>
<line x1="472" y1="913" x2="472" y2="935" stroke="black"/>
<polygon fill="white" points="389,914 449,914 449,923 389,923"/>
<text x="390" y="923" textLength="58" font-family="Helvetica" font-size="12" fill="black">
replay=D1;
</text>
<polygon fill="white" points="401,925 438,925 438,934 401,934"/>
<text x="402" y="934" textLength="35" font-family="Helvetica" font-size="12" fill="black">
up=S1
</text>
<line x1="60" y1="941" x2="60" y2="969" stroke="black"/>
<line x1="180" y1="941" x2="180" y2="969" stroke="black"/>
<line x1="300" y1="941" x2="300" y2="969" stroke="black"/>
<line x1="420" y1="941" x2="420" y2="969" stroke="black"/>
<line x1="540" y1="941" x2="540" y2="969" stroke="black"/>
<line x1="180" y1="952" x2="420" y2="952" stroke="black"/>
<line x1="420" y1="952" x2="410" y2="958" stroke="black"/>
<polygon fill="white" points="224,942 374,942 374,951 224,951"/>
<text x="225" y="951" textLength="148" font-family="Helvetica" font-size="12" fill="black">
ch_replay_v2(K2,V2,S2,S1)
</text>
<line x1="60" y1="969" x2="60" y2="997" stroke="black"/>
<line x1="180" y1="969" x2="180" y2="997" stroke="black"/>
<line x1="300" y1="969" x2="300" y2="997" stroke="black"/>
<line x1="420" y1="969" x2="420" y2="997" stroke="black"/>
<line x1="540" y1="969" x2="540" y2="997" stroke="black"/>
<polygon fill="white" points="368,969 472,969 472,991 368,991"/>
<line x1="368" y1="969" x2="472" y2="969" stroke="black"/>
<line x1="368" y1="991" x2="472" y2="991" stroke="black"/>
<line x1="368" y1="969" x2="368" y2="991" stroke="black"/>
<line x1="472" y1="969" x2="472" y2="991" stroke="black"/>
<polygon fill="white" points="380,970 459,970 459,979 380,979"/>
<text x="381" y="979" textLength="77" font-family="Helvetica" font-size="12" fill="black">
replay=D1,D2;
</text>
<polygon fill="white" points="401,981 438,981 438,990 401,990"/>
<text x="402" y="990" textLength="35" font-family="Helvetica" font-size="12" fill="black">
up=S2
</text>
<line x1="60" y1="997" x2="60" y2="1025" stroke="black"/>
<line x1="180" y1="997" x2="180" y2="1025" stroke="black"/>
<line x1="300" y1="997" x2="300" y2="1025" stroke="black"/>
<line x1="420" y1="997" x2="420" y2="1025" stroke="black"/>
<line x1="540" y1="997" x2="540" y2="1025" stroke="black"/>
<line x1="180" y1="1008" x2="420" y2="1008" stroke="black"/>
<line x1="420" y1="1008" x2="410" y2="1014" stroke="black"/>
<polygon fill="white" points="224,998 374,998 374,1007 224,1007"/>
<text x="225" y="1007" textLength="148" font-family="Helvetica" font-size="12" fill="black">
ch_replay_v2(K3,V3,S3,S2)
</text>
<line x1="60" y1="1025" x2="60" y2="1053" stroke="black"/>
<line x1="180" y1="1025" x2="180" y2="1053" stroke="black"/>
<line x1="300" y1="1025" x2="300" y2="1053" stroke="black"/>
<line x1="420" y1="1025" x2="420" y2="1053" stroke="black"/>
<line x1="540" y1="1025" x2="540" y2="1053" stroke="black"/>
<polygon fill="white" points="368,1025 472,1025 472,1047 368,1047"/>
<line x1="368" y1="1025" x2="472" y2="1025" stroke="black"/>
<line x1="368" y1="1047" x2="472" y2="1047" stroke="black"/>
<line x1="368" y1="1025" x2="368" y2="1047" stroke="black"/>
<line x1="472" y1="1025" x2="472" y2="1047" stroke="black"/>
<polygon fill="white" points="370,1026 468,1026 468,1035 370,1035"/>
<text x="371" y="1035" textLength="96" font-family="Helvetica" font-size="12" fill="black">
replay=D1,D2,D3;
</text>
<polygon fill="white" points="401,1037 438,1037 438,1046 401,1046"/>
<text x="402" y="1046" textLength="35" font-family="Helvetica" font-size="12" fill="black">
up=S3
</text>
<line x1="60" y1="1053" x2="60" y2="1070" stroke="black"/>
<line x1="180" y1="1053" x2="180" y2="1070" stroke="black"/>
<line x1="300" y1="1053" x2="300" y2="1070" stroke="black"/>
<line x1="420" y1="1053" x2="420" y2="1070" stroke="black"/>
<line x1="540" y1="1053" x2="540" y2="1070" stroke="black"/>
<line x1="30" y1="1058" x2="570" y2="1058" stroke="black" stroke-dasharray="2,2"/>
<polygon fill="white" points="266,1054 333,1054 333,1063 266,1063"/>
<text x="267" y="1063" textLength="65" font-family="Helvetica" font-size="12" fill="black">
tail acks S3.
</text>
<line x1="60" y1="1070" x2="60" y2="1098" stroke="black"/>
<line x1="180" y1="1070" x2="180" y2="1098" stroke="black"/>
<line x1="300" y1="1070" x2="300" y2="1098" stroke="black"/>
<line x1="420" y1="1070" x2="420" y2="1098" stroke="black"/>
<line x1="540" y1="1070" x2="540" y2="1098" stroke="black"/>
<path d="M 420 1075 A60,6 0 0,1 420,1087" stroke="black" fill="none"/><line x1="420" y1="1087" x2="430" y2="1093" stroke="black"/>
<polygon fill="white" points="381,1071 418,1071 418,1080 381,1080"/>
<text x="382" y="1080" textLength="35" font-family="Helvetica" font-size="12" fill="black">
timer()
</text>
<line x1="60" y1="1098" x2="60" y2="1126" stroke="black"/>
<line x1="180" y1="1098" x2="180" y2="1126" stroke="black"/>
<line x1="300" y1="1098" x2="300" y2="1126" stroke="black"/>
<line x1="420" y1="1098" x2="420" y2="1126" stroke="black"/>
<line x1="540" y1="1098" x2="540" y2="1126" stroke="black"/>
<polygon fill="white" points="368,1098 472,1098 472,1120 368,1120"/>
<line x1="368" y1="1098" x2="472" y2="1098" stroke="black"/>
<line x1="368" y1="1120" x2="472" y2="1120" stroke="black"/>
<line x1="368" y1="1098" x2="368" y2="1120" stroke="black"/>
<line x1="472" y1="1098" x2="472" y2="1120" stroke="black"/>
<polygon fill="white" points="376,1105 463,1105 463,1114 376,1114"/>
<text x="377" y="1114" textLength="85" font-family="Helvetica" font-size="12" fill="black">
replay= ; up=S3
</text>
<line x1="60" y1="1126" x2="60" y2="1154" stroke="black"/>
<line x1="180" y1="1126" x2="180" y2="1154" stroke="black"/>
<line x1="300" y1="1126" x2="300" y2="1154" stroke="black"/>
<line x1="420" y1="1126" x2="420" y2="1154" stroke="black"/>
<line x1="540" y1="1126" x2="540" y2="1154" stroke="black"/>
<line x1="420" y1="1137" x2="180" y2="1137" stroke="black"/>
<line x1="180" y1="1137" x2="190" y2="1143" stroke="black"/>
<polygon fill="white" points="278,1127 321,1127 321,1136 278,1136"/>
<text x="279" y="1136" textLength="41" font-family="Helvetica" font-size="12" fill="black">
ack(S3)
</text>
<line x1="60" y1="1154" x2="60" y2="1182" stroke="black"/>
<line x1="180" y1="1154" x2="180" y2="1182" stroke="black"/>
<line x1="300" y1="1154" x2="300" y2="1182" stroke="black"/>
<line x1="420" y1="1154" x2="420" y2="1182" stroke="black"/>
<line x1="540" y1="1154" x2="540" y2="1182" stroke="black"/>
<polygon fill="white" points="128,1154 232,1154 232,1176 128,1176"/>
<line x1="128" y1="1154" x2="232" y2="1154" stroke="black"/>
<line x1="128" y1="1176" x2="232" y2="1176" stroke="black"/>
<line x1="128" y1="1154" x2="128" y2="1176" stroke="black"/>
<line x1="232" y1="1154" x2="232" y2="1176" stroke="black"/>
<polygon fill="white" points="155,1155 203,1155 203,1164 155,1164"/>
<text x="156" y="1164" textLength="46" font-family="Helvetica" font-size="12" fill="black">
replay= ;
</text>
<polygon fill="white" points="153,1166 205,1166 205,1175 153,1175"/>
<text x="154" y="1175" textLength="50" font-family="Helvetica" font-size="12" fill="black">
down=S3
</text>
<line x1="60" y1="1182" x2="60" y2="1199" stroke="black"/>
<line x1="180" y1="1182" x2="180" y2="1199" stroke="black"/>
<line x1="300" y1="1182" x2="300" y2="1199" stroke="black"/>
<line x1="420" y1="1182" x2="420" y2="1199" stroke="black"/>
<line x1="540" y1="1182" x2="540" y2="1199" stroke="black"/>
<line x1="30" y1="1187" x2="570" y2="1187" stroke="black" stroke-dasharray="2,2"/>
<polygon fill="white" points="193,1183 406,1183 406,1192 193,1192"/>
<text x="194" y="1192" textLength="211" font-family="Helvetica" font-size="12" fill="black">
Head has D1,D2,D3, tail has D1,D2,D3.
</text>
<line x1="60" y1="1199" x2="60" y2="1216" stroke="black"/>
<line x1="180" y1="1199" x2="180" y2="1216" stroke="black"/>
<line x1="300" y1="1199" x2="300" y2="1216" stroke="black"/>
<line x1="420" y1="1199" x2="420" y2="1216" stroke="black"/>
<line x1="540" y1="1199" x2="540" y2="1216" stroke="black"/>
<line x1="30" y1="1204" x2="570" y2="1204" stroke="black" stroke-dasharray="2,2"/>
<polygon fill="white" points="161,1200 438,1200 438,1209 161,1209"/>
<text x="162" y="1209" textLength="275" font-family="Helvetica" font-size="12" fill="black">
OLD MIDDLE brick will start repair normall from tail.
</text>
<line x1="60" y1="1210" x2="60" y2="1216" stroke="black"/>
<line x1="180" y1="1210" x2="180" y2="1216" stroke="black"/>
<line x1="300" y1="1210" x2="300" y2="1216" stroke="black"/>
<line x1="420" y1="1210" x2="420" y2="1216" stroke="black"/>
<line x1="540" y1="1210" x2="540" y2="1216" stroke="black"/>
</svg>
